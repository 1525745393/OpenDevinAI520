# APIè®¾ç½®æŒ‡å— - å¢å¼ºç‰ˆé‡å‘½åå·¥å…·

## ğŸ“– æ¦‚è¿°

å¢å¼ºç‰ˆæ™ºèƒ½å½±è§†æ–‡ä»¶é‡å‘½åå·¥å…·é›†æˆäº†TMDbå’Œè±†ç“£APIï¼Œå¯ä»¥è‡ªåŠ¨è·å–å‡†ç¡®çš„å½±è§†å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ä¸­æ–‡æ ‡é¢˜ã€è¯„åˆ†ã€æµ·æŠ¥ã€å‰§æƒ…ç®€ä»‹ç­‰ä¿¡æ¯ã€‚

## ğŸŒ æ”¯æŒçš„API

### 1. TMDb (The Movie Database)
- **ç±»å‹**: å›½é™…å½±è§†æ•°æ®åº“
- **ä¼˜åŠ¿**: æ•°æ®å…¨é¢ã€æ›´æ–°åŠæ—¶ã€æ”¯æŒå¤šè¯­è¨€
- **éœ€è¦**: å…è´¹APIå¯†é’¥
- **é™åˆ¶**: æ¯ç§’40æ¬¡è¯·æ±‚

### 2. è±†ç“£ç”µå½±
- **ç±»å‹**: ä¸­æ–‡å½±è§†æ•°æ®åº“  
- **ä¼˜åŠ¿**: ä¸­æ–‡æ•°æ®å‡†ç¡®ã€è¯„åˆ†æƒå¨
- **éœ€è¦**: æ— éœ€APIå¯†é’¥
- **é™åˆ¶**: è®¿é—®é¢‘ç‡é™åˆ¶è¾ƒä¸¥æ ¼

## ğŸ”§ TMDb APIé…ç½®

### æ­¥éª¤1: æ³¨å†Œè´¦æˆ·

1. è®¿é—® [TMDbå®˜ç½‘](https://www.themoviedb.org/)
2. ç‚¹å‡»å³ä¸Šè§’ "Join TMDb" æ³¨å†Œè´¦æˆ·
3. å¡«å†™ç”¨æˆ·åã€é‚®ç®±ã€å¯†ç å®Œæˆæ³¨å†Œ
4. éªŒè¯é‚®ç®±æ¿€æ´»è´¦æˆ·

### æ­¥éª¤2: ç”³è¯·APIå¯†é’¥

1. ç™»å½•åè®¿é—® [APIè®¾ç½®é¡µé¢](https://www.themoviedb.org/settings/api)
2. ç‚¹å‡» "Create" åˆ›å»ºæ–°çš„APIå¯†é’¥
3. é€‰æ‹© "Developer" ç±»å‹
4. å¡«å†™åº”ç”¨ä¿¡æ¯ï¼š
   ```
   Application Name: Video Renamer Tool
   Application URL: https://github.com/your-repo
   Application Summary: æ™ºèƒ½å½±è§†æ–‡ä»¶é‡å‘½åå·¥å…·
   ```
5. åŒæ„æœåŠ¡æ¡æ¬¾ï¼Œæäº¤ç”³è¯·
6. å¤åˆ¶ç”Ÿæˆçš„APIå¯†é’¥ï¼ˆv3 authï¼‰

### æ­¥éª¤3: é…ç½®å·¥å…·

1. è¿è¡Œé‡å‘½åå·¥å…·
2. é€‰æ‹© "4. é…ç½®APIè®¾ç½®"
3. é€‰æ‹© "1. é…ç½®TMDb API"
4. ç²˜è´´APIå¯†é’¥
5. æµ‹è¯•è¿æ¥ç¡®è®¤é…ç½®æˆåŠŸ

### APIå¯†é’¥ç¤ºä¾‹
```
APIå¯†é’¥æ ¼å¼: a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6
é•¿åº¦: 32ä½å­—ç¬¦
```

## ğŸ­ è±†ç“£APIé…ç½®

### ç‰¹ç‚¹è¯´æ˜
- **æ— éœ€æ³¨å†Œ**: ç›´æ¥å¯ç”¨å³å¯ä½¿ç”¨
- **è®¿é—®é™åˆ¶**: æœ‰é¢‘ç‡é™åˆ¶ï¼Œå»ºè®®é€‚åº¦ä½¿ç”¨
- **æ•°æ®è´¨é‡**: ä¸­æ–‡æ•°æ®å‡†ç¡®ï¼Œè¯„åˆ†æƒå¨

### é…ç½®æ­¥éª¤
1. è¿è¡Œé‡å‘½åå·¥å…·
2. é€‰æ‹© "4. é…ç½®APIè®¾ç½®"
3. é€‰æ‹© "2. å¯ç”¨/ç¦ç”¨è±†ç“£API"
4. é€‰æ‹©å¯ç”¨
5. æµ‹è¯•è¿æ¥ç¡®è®¤å¯ç”¨

### ä½¿ç”¨å»ºè®®
- ä¸»è¦ç”¨äºè·å–ä¸­æ–‡æ ‡é¢˜å’Œè±†ç“£è¯„åˆ†
- ä¸TMDbé…åˆä½¿ç”¨æ•ˆæœæœ€ä½³
- å¤§æ‰¹é‡å¤„ç†æ—¶å»ºè®®é™ä½é¢‘ç‡

## âš™ï¸ é…ç½®æ–‡ä»¶è¯¦è§£

### APIè®¾ç½®éƒ¨åˆ†
```json
{
  "api_settings": {
    "tmdb": {
      "enabled": true,
      "api_key": "your_tmdb_api_key_here",
      "language": "zh-CN",
      "region": "CN"
    },
    "douban": {
      "enabled": true
    },
    "general": {
      "timeout": 10,
      "retry_count": 3,
      "rate_limit_delay": 1.0,
      "cache_enabled": true,
      "cache_expire_days": 7
    }
  }
}
```

### å…ƒæ•°æ®è®¾ç½®éƒ¨åˆ†
```json
{
  "metadata_settings": {
    "fetch_metadata": true,
    "generate_nfo": true,
    "download_posters": true,
    "download_fanart": true,
    "prefer_chinese_title": true,
    "fallback_to_original": true,
    "metadata_priority": ["tmdb", "douban"],
    "poster_size": "w500",
    "fanart_size": "w1280"
  }
}
```

## ğŸ¨ å¢å¼ºç‰ˆå‘½åæ¨¡æ¿

### ç”µå½±æ¨¡æ¿ç¤ºä¾‹

#### 1. å¢å¼ºç¾¤æ™–æ¨¡æ¿
```
æ¨¡æ¿: {chinese_title} {title} ({year}) [{resolution}] [{quality}] [è¯„åˆ†{rating}].{ext}
ç¤ºä¾‹: è‚–ç”³å…‹çš„æ•‘èµ The Shawshank Redemption (1994) [1080p] [BluRay] [è¯„åˆ†9.7].mkv
```

#### 2. å…ƒæ•°æ®ä¸°å¯Œæ¨¡æ¿
```
æ¨¡æ¿: {title} ({year}) [TMDb{tmdb_rating}] [è±†ç“£{douban_rating}] [{resolution}].{ext}
ç¤ºä¾‹: The Shawshank Redemption (1994) [TMDb9.3] [è±†ç“£9.7] [1080p].mkv
```

#### 3. ä¸­æ–‡ä¼˜å…ˆæ¨¡æ¿
```
æ¨¡æ¿: {chinese_title} ({year}) [{resolution}] [{quality}].{ext}
ç¤ºä¾‹: è‚–ç”³å…‹çš„æ•‘èµ (1994) [1080p] [BluRay].mkv
```

### ç”µè§†å‰§æ¨¡æ¿ç¤ºä¾‹

#### 1. å¢å¼ºç¾¤æ™–æ¨¡æ¿
```
æ¨¡æ¿: {chinese_title} {title} S{season:02d}E{episode:02d} [{resolution}] [{quality}] [è¯„åˆ†{rating}].{ext}
ç¤ºä¾‹: æƒåŠ›çš„æ¸¸æˆ Game of Thrones S01E01 [1080p] [BluRay] [è¯„åˆ†9.3].mkv
```

#### 2. å…ƒæ•°æ®ä¸°å¯Œæ¨¡æ¿
```
æ¨¡æ¿: {title} S{season:02d}E{episode:02d} [TMDb{tmdb_rating}] [è±†ç“£{douban_rating}] [{resolution}].{ext}
ç¤ºä¾‹: Game of Thrones S01E01 [TMDb9.3] [è±†ç“£9.3] [1080p].mkv
```

### å¯ç”¨å˜é‡è¯´æ˜

| å˜é‡ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `{chinese_title}` | ä¸­æ–‡æ ‡é¢˜ | è‚–ç”³å…‹çš„æ•‘èµ |
| `{title}` | è‹±æ–‡/åŸå§‹æ ‡é¢˜ | The Shawshank Redemption |
| `{original_title}` | åŸå§‹è¯­è¨€æ ‡é¢˜ | The Shawshank Redemption |
| `{year}` | å¹´ä»½ | 1994 |
| `{tmdb_rating}` | TMDbè¯„åˆ† | 9.3 |
| `{douban_rating}` | è±†ç“£è¯„åˆ† | 9.7 |
| `{rating}` | æœ€ä½³è¯„åˆ† | 9.7 |
| `{director}` | å¯¼æ¼” | Frank Darabont |
| `{genre}` | ç±»å‹ | å‰§æƒ…, çŠ¯ç½ª |
| `{resolution}` | åˆ†è¾¨ç‡ | 1080p |
| `{quality}` | ç”»è´¨ | BluRay |

## ğŸ“„ NFOæ–‡ä»¶ç”Ÿæˆ

### ä»€ä¹ˆæ˜¯NFOæ–‡ä»¶
NFOæ–‡ä»¶æ˜¯åª’ä½“ä¸­å¿ƒï¼ˆå¦‚Kodiã€Jellyfinã€Embyï¼‰ä½¿ç”¨çš„å…ƒæ•°æ®æ–‡ä»¶ï¼ŒåŒ…å«å½±ç‰‡çš„è¯¦ç»†ä¿¡æ¯ã€‚

### ç”Ÿæˆçš„NFOå†…å®¹
- æ ‡é¢˜ï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰
- å¹´ä»½å’Œä¸Šæ˜ æ—¥æœŸ
- è¯„åˆ†ï¼ˆTMDb/è±†ç“£ï¼‰
- ç±»å‹å’Œå¯¼æ¼”
- æ¼”å‘˜åˆ—è¡¨
- å‰§æƒ…ç®€ä»‹
- å¤–éƒ¨IDï¼ˆTMDb/IMDb/è±†ç“£ï¼‰

### NFOæ–‡ä»¶ç¤ºä¾‹
```xml
<?xml version='1.0' encoding='utf-8'?>
<movie>
  <title>è‚–ç”³å…‹çš„æ•‘èµ</title>
  <originaltitle>The Shawshank Redemption</originaltitle>
  <year>1994</year>
  <premiered>1994-09-23</premiered>
  <runtime>142</runtime>
  <plot>é“¶è¡Œå®¶å®‰è¿ªå› ä¸ºå¦»å­å’Œå¥¹çš„æƒ…äººè¢«æ€è€Œè¢«åˆ¤æ— æœŸå¾’åˆ‘...</plot>
  <director>Frank Darabont</director>
  <rating name="tmdb" max="10">
    <value>8.7</value>
    <votes>24000</votes>
  </rating>
  <rating name="douban" max="10">
    <value>9.7</value>
  </rating>
  <genre>å‰§æƒ…</genre>
  <genre>çŠ¯ç½ª</genre>
  <actor>
    <name>Tim Robbins</name>
  </actor>
  <actor>
    <name>Morgan Freeman</name>
  </actor>
  <uniqueid type="tmdb">278</uniqueid>
  <uniqueid type="imdb">tt0111161</uniqueid>
  <uniqueid type="douban">1292052</uniqueid>
</movie>
```

## ğŸ–¼ï¸ æµ·æŠ¥ä¸‹è½½

### æ”¯æŒçš„å›¾ç‰‡ç±»å‹
- **Poster**: ç”µå½±æµ·æŠ¥ï¼ˆç«–ç‰ˆï¼‰
- **Fanart**: èƒŒæ™¯å›¾ï¼ˆæ¨ªç‰ˆï¼‰

### å›¾ç‰‡å°ºå¯¸é€‰é¡¹
- `w92` - 92pxå®½åº¦ï¼ˆç¼©ç•¥å›¾ï¼‰
- `w154` - 154pxå®½åº¦ï¼ˆå°å›¾ï¼‰
- `w185` - 185pxå®½åº¦ï¼ˆä¸­å›¾ï¼‰
- `w342` - 342pxå®½åº¦ï¼ˆå¤§å›¾ï¼‰
- `w500` - 500pxå®½åº¦ï¼ˆé«˜æ¸…ï¼‰
- `w780` - 780pxå®½åº¦ï¼ˆè¶…æ¸…ï¼‰
- `original` - åŸå§‹å°ºå¯¸

### æ–‡ä»¶å‘½åè§„åˆ™
```
ç”µå½±æµ·æŠ¥: ç”µå½±å-poster.jpg
èƒŒæ™¯å›¾: ç”µå½±å-fanart.jpg
```

## ğŸš€ ä½¿ç”¨æµç¨‹

### 1. é¦–æ¬¡é…ç½®
```bash
# è¿è¡Œç¨‹åº
python3 video_renamer_enhanced.py

# é€‰æ‹©é…ç½®API
4 -> 1 -> è¾“å…¥TMDb APIå¯†é’¥
4 -> 2 -> å¯ç”¨è±†ç“£API

# æµ‹è¯•è¿æ¥
5 -> ç¡®è®¤APIå¯ç”¨
```

### 2. é¢„è§ˆé‡å‘½å
```bash
# é€‰æ‹©é¢„è§ˆæ¨¡å¼
1 -> è¾“å…¥ç›®å½•è·¯å¾„ -> æŸ¥çœ‹é¢„è§ˆç»“æœ
```

### 3. æ‰§è¡Œé‡å‘½å
```bash
# é€‰æ‹©é‡å‘½åæ¨¡å¼
2 -> è¾“å…¥ç›®å½•è·¯å¾„ -> ç¡®è®¤æ‰§è¡Œ
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. TMDb APIè¿æ¥å¤±è´¥
**å¯èƒ½åŸå› :**
- APIå¯†é’¥é”™è¯¯æˆ–è¿‡æœŸ
- ç½‘ç»œè¿æ¥é—®é¢˜
- è¶…å‡ºAPIè°ƒç”¨é™åˆ¶

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ£€æŸ¥APIå¯†é’¥
curl "https://api.themoviedb.org/3/movie/550?api_key=YOUR_API_KEY"

# é‡æ–°é…ç½®APIå¯†é’¥
ç¨‹åºèœå• -> 4 -> 1 -> é‡æ–°è¾“å…¥å¯†é’¥
```

#### 2. è±†ç“£APIè®¿é—®å—é™
**å¯èƒ½åŸå› :**
- è®¿é—®é¢‘ç‡è¿‡é«˜
- IPè¢«ä¸´æ—¶é™åˆ¶
- ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ¡ˆ:**
```bash
# é™ä½è®¿é—®é¢‘ç‡
é…ç½®æ–‡ä»¶ -> api_settings.general.rate_limit_delay = 2.0

# æš‚æ—¶ç¦ç”¨è±†ç“£API
ç¨‹åºèœå• -> 4 -> 2 -> ç¦ç”¨
```

#### 3. å…ƒæ•°æ®åŒ¹é…ä¸å‡†ç¡®
**å¯èƒ½åŸå› :**
- æ–‡ä»¶åæ ¼å¼ä¸æ ‡å‡†
- æ ‡é¢˜åŒ…å«ç‰¹æ®Šå­—ç¬¦
- å¹´ä»½ä¿¡æ¯ç¼ºå¤±

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ‰‹åŠ¨æ¸…ç†æ–‡ä»¶å
é‡å‘½åä¸ºæ ‡å‡†æ ¼å¼: ç”µå½±å.å¹´ä»½.å…¶ä»–ä¿¡æ¯.æ‰©å±•å

# è°ƒæ•´åŒ¹é…é˜ˆå€¼
é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ç›¸ä¼¼åº¦ç®—æ³•å‚æ•°
```

#### 4. NFOæ–‡ä»¶ç”Ÿæˆå¤±è´¥
**å¯èƒ½åŸå› :**
- æƒé™ä¸è¶³
- ç£ç›˜ç©ºé—´ä¸è¶³
- æ–‡ä»¶è·¯å¾„åŒ…å«ç‰¹æ®Šå­—ç¬¦

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ£€æŸ¥æƒé™
chmod 755 ç›®æ ‡ç›®å½•

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# é¿å…ç‰¹æ®Šå­—ç¬¦
ä½¿ç”¨è‹±æ–‡è·¯å¾„å’Œæ–‡ä»¶å
```

### æ—¥å¿—åˆ†æ

#### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/video_renamer.log

# æœç´¢é”™è¯¯ä¿¡æ¯
grep "ERROR" logs/video_renamer.log

# æœç´¢APIç›¸å…³æ—¥å¿—
grep "API" logs/video_renamer.log
```

#### å¸¸è§æ—¥å¿—ä¿¡æ¯
```
INFO - ä»TMDbæœç´¢ç”µå½±: The Matrix
INFO - TMDbè·å–æˆåŠŸ: The Matrix (1999)
WARNING - è±†ç“£APIè®¿é—®å—é™ï¼Œç¨åé‡è¯•
ERROR - TMDb APIé”™è¯¯: Invalid API key
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥
- å¯ç”¨å…ƒæ•°æ®ç¼“å­˜é¿å…é‡å¤APIè°ƒç”¨
- ç¼“å­˜æœ‰æ•ˆæœŸé»˜è®¤7å¤©
- æ‰‹åŠ¨æ¸…ç†ç¼“å­˜: ç¨‹åºèœå• -> 6

### 2. æ‰¹å¤„ç†å»ºè®®
- å•æ¬¡å¤„ç†å»ºè®®ä¸è¶…è¿‡100ä¸ªæ–‡ä»¶
- å¤§æ‰¹é‡å¤„ç†æ—¶åˆ†æ‰¹è¿›è¡Œ
- ç½‘ç»œä¸ç¨³å®šæ—¶é™ä½å¹¶å‘æ•°

### 3. APIè°ƒç”¨ä¼˜åŒ–
- è®¾ç½®åˆç†çš„è¯·æ±‚é—´éš”
- å¯ç”¨é‡è¯•æœºåˆ¶
- ä¼˜å…ˆä½¿ç”¨ç¼“å­˜æ•°æ®

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. APIå¯†é’¥ä¿æŠ¤
- ä¸è¦åœ¨å…¬å¼€åœºæ‰€åˆ†äº«APIå¯†é’¥
- å®šæœŸæ›´æ¢APIå¯†é’¥
- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯

### 2. ç½‘ç»œå®‰å…¨
- ä½¿ç”¨HTTPSè¿æ¥
- é¿å…åœ¨ä¸å®‰å…¨ç½‘ç»œç¯å¢ƒä¸‹ä½¿ç”¨
- å®šæœŸæ›´æ–°ç¨‹åºç‰ˆæœ¬

### 3. æ•°æ®éšç§
- APIè°ƒç”¨ä¼šå‘é€æ–‡ä»¶åä¿¡æ¯
- ä¸ä¼šä¸Šä¼ å®é™…æ–‡ä»¶å†…å®¹
- ç¼“å­˜æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è·å–å¸®åŠ©
1. æŸ¥çœ‹ç¨‹åºå†…ç½®å¸®åŠ©ï¼ˆèœå•é€‰é¡¹7ï¼‰
2. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶é”™è¯¯ä¿¡æ¯
3. éªŒè¯APIé…ç½®å’Œç½‘ç»œè¿æ¥
4. å‚è€ƒæœ¬æŒ‡å—æ•…éšœæ’é™¤éƒ¨åˆ†

### åé¦ˆé—®é¢˜
æä¾›ä»¥ä¸‹ä¿¡æ¯æœ‰åŠ©äºé—®é¢˜è¯Šæ–­ï¼š
- æ“ä½œç³»ç»Ÿå’ŒPythonç‰ˆæœ¬
- APIé…ç½®çŠ¶æ€
- é”™è¯¯æ—¥å¿—å†…å®¹
- é—®é¢˜æ–‡ä»¶åç¤ºä¾‹
- ç½‘ç»œç¯å¢ƒä¿¡æ¯

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

> ğŸ’¡ **å°è´´å£«**: å»ºè®®é¦–æ¬¡ä½¿ç”¨æ—¶å…ˆåœ¨æµ‹è¯•ç›®å½•ä¸­å°è¯•ï¼Œç†Ÿæ‚‰APIåŠŸèƒ½åå†å¤„ç†é‡è¦æ–‡ä»¶ã€‚